---
import Layout from "@layouts/Default.astro";
import { Pill, Card } from '@eliancodes/brutal-ui';
import members from '../../content/members.json';

// Urutan: Active → role (Ketua, Sekretaris, Bendahara) → alfabet
members.sort((a, b) => {
  const order = ["Ketua Kelas", "Sekretaris", "Bendahara"];

  // Default aktif = true
  const isActiveA = a.active !== false;
  const isActiveB = b.active !== false;

  // 1. Active group first
  if (isActiveA !== isActiveB) {
    return isActiveA ? -1 : 1;
  }

  // 2. Sorting special roles (only affects active members)
  const ia = order.indexOf(a.role);
  const ib = order.indexOf(b.role);
  if (ia !== -1 && ib !== -1) return ia - ib;
  if (ia !== -1) return -1;
  if (ib !== -1) return 1;

  // 3. Sort by name inside the group
  return a.name.localeCompare(b.name);
});

const displayMembers = members.length > 0 ? members : [];
---

<Layout
  title="Class Members"
  description="Class Members | Daftar lengkap anggota kelas beserta peran dan kontribusinya"
  pageTitle="Class Members"
>
  <main class="bg-blue p-6">
    <!-- Header Section -->
    <section class="mb-8 text-center">
      <h1 class="text-2xl md:text-4xl lg:text-6xl font-bold mb-4 dm-serif">Anggota Kelas kami</h1>
    </section>

    <!-- Members Grid -->
    <section id='class-members' class='grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6'>
      {displayMembers.map((member, index) => (
        <div key={index} class='w-full flip-card-container'>
          <div class="flip-card" id={`card-${index}`}>

            <!-- Front Side -->
            <div class="flip-card-front">
              <Card>
                <div class="flex flex-col text-center h-full">
                  <div class="w-full aspect-square mb-4 overflow-hidden bg-gray-200 flex items-center justify-center">
                    {member.photo ? (
                      <img 
                        src={member.photo} 
                        alt={member.name}
                        class="w-full h-full object-cover"
                      />
                    ) : (
                      <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-400 to-purple-500">
                        <span class="text-6xl font-bold text-white">
                          {member.name.charAt(0)}
                        </span>
                      </div>
                    )}
                  </div>
                  
                  <div class="px-4 pb-4">
                    <h3 class="text-xl font-bold mb-2">
                      {member.name}
                    </h3>

                    <Pill>
                      <a 
                        href={`https://instagram.com/${member.instagram.replace('@', '')}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        onclick="event.stopPropagation()"
                      >
                        {member.instagram.startsWith('@') ? member.instagram : `@${member.instagram}`}
                      </a>
                    </Pill>
                  </div>
                </div>
              </Card>
            </div>

            <!-- Back Side -->
            <div class="flip-card-back">
              <Card>
                <div class="flex-1 flex items-center justify-center px-6 py-8">
                  <div class="text-center space-y-8">
                    <div>
                      <p class="text-4xl font-black leading-tight">
                        {member.role || "Class Member"}
                      </p>
                    </div>

                    <div class="flex flex-wrap justify-center gap-3">
                      {Array.isArray(member.skills) && member.skills.length > 0 ? (
                        member.skills.map((skill) => (
                          <span class="bg-black text-white px-5 py-2 font-bold text-sm uppercase tracking-wider">
                            {skill}
                          </span>
                        ))
                      ) : (
                        <p class="italic text-lg opacity-80 leading-tight">
                          Sedang menguasai dunia<br />secara diam-diam
                        </p>
                      )}
                    </div>
                  </div>
                </div>

                <div class="px-6 pb-8">
                  <ul class="flex justify-center gap-6">
                    {member.linkedin && (
                      <li class="bg-white px-4 py-2 text-green border-black border-2 rounded card-shadow hover:translate-y-[-4px] transition">
                        <a href={member.linkedin} target="_blank" title="LinkedIn" onclick="event.stopPropagation()">
                          <div class:list={['i-uil-linkedin', 'text-4xl']} />
                        </a>
                      </li>
                    )}
                    {member.github && (
                      <li class="bg-white px-4 py-2 text-green border-black border-2 rounded card-shadow hover:translate-y-[-4px] transition">
                        <a href={member.github} target="_blank" title="GitHub" onclick="event.stopPropagation()">
                          <div class:list={['i-uil-github', 'text-4xl']} />
                        </a>
                      </li>
                    )}
                  </ul>
                </div>
              </Card>
            </div>

          </div>
        </div>
      ))}
    </section>

    <!-- Empty State -->
    {displayMembers.length === 0 && (
      <section class="text-center py-0">
        <Card>
          <div class="p-8">
            <p class="text-xl text-gray-600">
              Belum ada data anggota kelas. Silakan tambahkan data anggota terlebih dahulu.
            </p>
          </div>
        </Card>
      </section>
    )}
  </main>
</Layout>

<style>
  .flip-card-container { perspective: 1000px; }
  .flip-card { position: relative; width: 100%; height: 100%; min-height: 400px; transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; }
  .flip-card.flipped { transform: rotateY(180deg); }
  .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; }
  .flip-card-back { transform: rotateY(180deg); }
  .flip-card-front > :global(*), .flip-card-back > :global(*) { height: 100%; }
</style>

<script>
  (function () {
    if (window.__flipCardsInitialized) return;
    window.__flipCardsInitialized = true;

    function onDocClick(e) {
      if (e.cancelBubble) return;
      const card = e.target.closest('.flip-card');
      if (!card) return;
      card.classList.toggle('flipped');
    }

    document.addEventListener('click', onDocClick);
  })();
</script>
